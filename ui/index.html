<!DOCTYPE html>
<html lang="en" data-theme="light"> <!-- change to "dark" to default dark -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DAEDALUS #1043 — Ground Station</title>

  <!-- Libs -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net"/>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.css"/>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.js"></script>

  <!-- App styles -->
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <!-- HEADER -->
  <header class="topbar">
    <div class="brandwrap">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="brand">DAEDALUS <span class="tag">#1043</span></div>
        <div class="sub">DDL-MissionControl</div>
      </div>
    </div>

    <div class="top-clocks">
      <div id="utcClock" class="clock-badge">UTC: 00:00:00</div>
      <div id="missionTime" class="clock-badge mission">Mission: 00:00:00</div>
    </div>

    <div class="status">
      <div id="connPill" class="pill">Disconnected</div>
      <button id="toggleTheme" class="btn sm ghost" title="Toggle light/dark (saves)">
        Theme
      </button>
    </div>
  </header>

  <!-- HIGHLIGHTS STRIP -->
  <section class="strip-highlights">
    <div class="kv-major-large">
      <div class="k">State</div>
      <div id="missionState" class="v">--</div>
    </div>
    <div class="kv-major-large">
      <div class="k">Altitude (m)</div>
      <div id="liveAltitude" class="v">--</div>
    </div>
    <div class="kv-major">
      <div class="k">Mode</div>
      <div id="missionMode" class="v">--</div>
    </div>
    <div class="kv-major">
      <div class="k">GPS Sats</div>
      <div id="gpsSats" class="v">--</div>
    </div>
    <div class="compass-container">
      <div class="compass">
        <div class="compass-arrow" id="compassArrow"></div>
      </div>
      <div class="heading-text" id="heading">--°</div>
    </div>
    <div class="kv-major">
        <div class="k">RX Packets</div>
        <div id="rxCount" class="v ok">0</div>
    </div>
    <div class="kv-major">
        <div class="k">Lost Packets</div>
        <div id="lossCount" class="v">0</div>
    </div>
    <div class="group">
        <button id="btnOpenCsvFolder" class="btn sm">Log Folder</button>
        <button id="btnSim" class="btn sm">Run Sim</button>
    </div>
  </section>

  <!-- MAIN GRID -->
  <main class="screen">
    <!-- MAP (Right Column, Top) -->
    <section class="panel map-panel">
      <div class="panel-title">
        <div>GPS LOCATION <span id="gpsMiniTitle" class="gpsmini">—, — • sats: —</span></div>
        <div class="missionbar">
          <button id="btnStartMission" class="btn primary sm">Start Mission</button>
          <button id="toggleMapSize" class="btn sm ghost">Full</button>
          <div class="bigtime">T+ <b id="missionTimeBig">00:00:00</b></div>
        </div>
      </div>
      <div id="map" class="map"></div>
      <div class="gmaplink"><a id="gmapA" href="#" target="_blank" rel="noopener">Open in Google Maps</a></div>
    </section>

    <!-- GRAPHS AND VALUES (Left Column) -->
    <section class="panel values-panel">
      <!-- Altitude Chart -->
      <div class="chartbox-main">
        <div class="charttitle-wrap">
          <div class="charttitle">Altitude Profile (m)</div>
          <div class="chart-toggles" id="altitudeToggles">
            <button class="btn sm active" data-series="Baro Alt">Baro</button>
            <button class="btn sm active" data-series="GPS Alt">GPS</button>
          </div>
        </div>
        <div id="chart-altitude"></div>
      </div>
      
      <!-- Key Values Grid -->
      <div class="panel-title">KEY VALUES</div>
      <div class="values-grid">
        <div class="kv-cell"><div class="k">Temperature</div><div id="val_temp" class="v">-- °C</div></div>
        <div class="kv-cell"><div class="k">Pressure</div><div id="val_pressure" class="v">-- kPa</div></div>
        <div class="kv-cell"><div class="k">Voltage</div><div id="val_voltage" class="v">-- V</div></div>
        <div class="kv-cell"><div class="k">Current</div><div id="val_current" class="v">-- A</div></div>
        
        <div class="kv-group">
          <div class="k">Gyro (deg/s)</div>
          <div class="v-group">
            <span>X: <b id="val_gyro_x">--</b></span>
            <span>Y: <b id="val_gyro_y">--</b></span>
            <span>Z: <b id="val_gyro_z">--</b></span>
          </div>
        </div>
        
        <div class="kv-group">
          <div class="k">Accel (m/s²)</div>
          <div class="v-group">
            <span>X: <b id="val_accel_x">--</b></span>
            <span>Y: <b id="val_accel_y">--</b></span>
            <span>Z: <b id="val_accel_z">--</b></span>
          </div>
        </div>
      </div>
    </section>

    <!-- LOGS (Right Column, Bottom) -->
    <section class="panel logs-panel">
      <div class="panel-title">
        <div>Telemetry Control &amp; Logs</div>
        <div class="lastcmd"><div class="tit">Last Cmd</div><div id="lastCmd" class="val">—</div></div>
      </div>
      <div class="logs-content">
        <div class="cmdrow">
          <select id="quickCmd" class="sel wide"></select>
          <input id="manualCmd" class="input grow" placeholder="Manual command... e.g., CX,ON"/>
          <button id="sendCmd" class="btn primary sm">Send</button>
        </div>
        <div class="log-controls">
          <div class="left" style="display:flex;gap:8px;align-items:center">
            <label class="tiny">Latest</label>
            <input type="number" id="logN" min="50" max="5000" value="500" class="input" style="width:70px">
            <button id="refreshLogs" class="btn ghost sm">Clear Log</button>
            <label class="chk"><input type="checkbox" id="autoScroll" checked> Auto</label>
            <label class="chk"><input type="checkbox" id="freeze"> Freeze</label>
            <label class="chk"><input type="checkbox"id="wrapLines"> Wrap</label>
          </div>
          <div class="right" style="display:flex;gap:8px;align-items:center">
            <button id="copyLogs" class="btn sm">Copy Log</button>
            <button id="btnResetAllTop" class="btn danger sm">Reset UI</button>
          </div>
        </div>
        <div id="rawBox" class="rawbox" aria-live="polite"></div>
        <div id="jumpLive" class="jump-live" hidden><button id="jumpLiveBtn" class="btn primary sm">Jump to Live</button></div>
      </div>
    </section>
  </main>

  <!-- sync small→big time -->
  <script>
    (function(){
      const s=document.getElementById('missionTime'),b=document.getElementById('missionTimeBig');
      if(!s||!b)return;
      new MutationObserver(()=>{b.textContent=s.textContent.replace('Mission: ','')})
      .observe(s,{childList:true,characterData:true,subtree:true});
    })();
  </script>

  <script>window.DGS_TEAM_ID = 1043;</script>
  <script src="app.js"></script>
</body>
</html>
